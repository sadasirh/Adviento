<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calendario de Adviento</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --rojo: #961833;
    --rojo-dark: #6e101f;
    --beige: #F7F3EA;
    --white: #FFFFFF;
    --shadow: 0 6px 16px rgba(0,0,0,0.12);
    --radius: 18px;
    --max-width: 900px;
}

body {
    margin: 0;
    padding: 0;
    font-family: "Inter", sans-serif;
    background: var(--beige);
    color: #333;
    text-align: center;
}

h1 {
    margin-top: 22px;
    font-weight: 700;
    font-size: 28px;
    color: var(--rojo-dark);
}

.main-container {
    width: 95%;
    max-width: var(--max-width);
    margin: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
}

#header-image {
    width: 100%;
    height: auto;
    margin: 15px 0;
    border-radius: var(--radius);
}

#register-container {
    margin: 20px 0;
    padding: 15px 20px;
    background: var(--white);
    width: 100%;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    text-align: left;
    box-sizing: border-box;
}

#register-container h3 {
    margin: 0 0 10px;
    font-weight: 600;
    font-size: 20px;
    color: var(--rojo-dark);
}

#instructions {
    font-size: 16px;
    margin-bottom: 10px;
    line-height: 1.5;
}

input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #d5d5d5;
    border-radius: 10px;
    font-size: 16px;
    background: #fafafa;
    box-sizing: border-box;
}

button {
    padding: 12px;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s;
}

#register-btn {
    background: var(--rojo);
    flex: 1;
}

#register-btn:hover {
    background: var(--rojo-dark);
}

#recover-btn {
    background: #888;
    flex: 1;
}

#recover-btn:hover {
    background: #555;
}

#grid {
    margin: 35px 0 60px 0;
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 18px;
    width: 100%;
}

@media (max-width: 600px) {
    #grid {
        display: flex;
        overflow-x: auto;
        padding-bottom: 10px;
        -webkit-overflow-scrolling: touch;
    }
    .day-btn {
        flex: 0 0 120px;
    }
}

.day-btn {
    position: relative;
    height: 160px;
    border-radius: var(--radius);
    overflow: hidden;
    border: none;
    cursor: pointer;
    box-shadow: var(--shadow);
    padding: 0;
    background: none;
}

.day-btn img.day-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

/* Ocultar números de los días visualmente, pero dejar para JS */
.day-number {
    display: none;
}

#modal {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
    z-index: 99;
}

#modal-box {
    background: white;
    padding: 28px;
    width: 95%;
    max-width: 600px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    text-align: center;
    position: relative;
}

#modal-box img {
    width: 100%;
    aspect-ratio: 1/1;
    object-fit: contain;
    border-radius: var(--radius);
    margin-bottom: 20px;
    background: #f0f0f0;
}

#modal-box h2 {
    margin: 0 0 10px;
    color: var(--rojo-dark);
    font-size: 26px;
}

#modal-box button {
    background: var(--rojo);
    color: #fff;
    font-weight: 600;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 16px;
    border: none;
    cursor: pointer;
}

#modal-box button:hover {
    background: var(--rojo-dark);
}

#modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: var(--rojo-dark);
    color: white;
    border: none;
    font-size: 18px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

/* Estilo para días completados */
.day-completed::after {
    content: "✓";
    position: absolute;
    top: 8px;
    right: 8px;
    background: green;
    color: white;
    font-weight: bold;
    font-size: 18px;
    width: 24px;
    height: 24px;
    text-align: center;
    line-height: 24px;
    border-radius: 50%;
}

/* Barra de progreso */
#progress-container {
    width: 100%;
    background: #ddd;
    border-radius: 10px;
    overflow: hidden;
    height: 20px;
    margin-top: 10px;
}

#progress-bar {
    height: 100%;
    width: 0%;
    background: var(--rojo);
    text-align: center;
    color: white;
    font-weight: 600;
    line-height: 20px;
}
</style>
</head>

<body>

<div class="main-container">

<!--     <h1>Calendario de Adviento</h1> -->
    <img src="images/header.jpg" alt="Encabezado" id="header-image">

    <div id="register-container">
        <h3>¡Bienvenido!</h3>
        <div id="instructions">
            1. Escribe tu nombre completo en el campo de abajo y presiona <strong>Registrar</strong>.<br>
            2. Haz clic en la tarjeta del día correspondiente, realiza la actividad y presiona <strong>Lo hice</strong>. Espera a que aparezca el mensaje de confirmación para asegurarte de que tu actividad se registró correctamente.<br>
            3. Si ya estás registrado, escribe tu nombre y haz clic en <strong>Recuperar</strong> para continuar con tu progreso.
        </div>
        <input type="text" id="name-input" placeholder="Escribe tu nombre">
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button id="register-btn" onclick="registerUser()">Registrar</button>
            <button id="recover-btn" onclick="recoverUser()">Recuperar</button>
        </div>
        <div id="progress-container">
            <div id="progress-bar">0%</div>
        </div>
    </div>

    <div id="grid"></div>

</div>

<div id="modal" onclick="closeModal(event)">
    <div id="modal-box">
        <button id="modal-close" onclick="closeModalBtn(event)">×</button>
        <img id="modal-image" src="" alt="Imagen del día">
        <h2 id="modal-title"></h2>
        <button onclick="confirmActivity()">Lo hice</button>
    </div>
</div>

<script>
const DEPLOY_URL = "https://script.google.com/macros/s/AKfycbwXItDc74c84v2Ut0E8F4e1X2Qu2iuYVXexTdiYflGlA0H66DwLDWywqHHMG0aZKLGwXw/exec";

const actividades = {
30: "Graba un video sobre el significado del Adviento, compártelo con nosotros y en tus redes sociales.",
1: "Háblale de Jesús a alguien que tenga una dificultad.",
2: "Practica la virtud de la justicia siendo misericordioso y caritativo con el más necesitado.",
3: "Sal de tu zona de confort y asume el reto de transformar al menos una realidad o problema.",
4: "Pídele perdón o perdona a un hermano a través de un acto.",
5: "Acércate a la Eucaristía para alimentar tu espíritu con su cuerpo, sangre y palabra.",
6: "Busca una oveja sin pastor, herida por la vida y acércala a Dios.",
7: "Realiza un buen examen de conciencia para una buena confesión.",
8: "Graba un video diciendo: ¿Qué causa tanta alegría? La Inmaculada Concepción de María, compártelo con nosotros y en tus redes sociales.",
9: "Pide la intercesión de María para que quedes libre de toda mancha de pecado.",
10: "Haz un acto de amor con tu madre o figura materna. ¿Qué haría Jesús?",
11: "Junto a tu familia, elabora un pequeño altar a María en un lugar especial de tu casa.",
12: "Regala rosas de oración a las personas que sabes que están pasando algún momento difícil.",
13: "Sonríe todo el día a todos sin excepción alguna.",
14: "Reúnete en comunidad y organiza una reunión llena de alabanzas para Dios y nuestra Santa Madre.",
15: "Reza un Padre Nuestro.",
16: "Escribe 3 cosas que quieres mejorar.",
17: "Este día tienes la oportunidad de sembrar la semilla de la fe por medio de tu mensaje.",
18: "Regala una de tus prendas favoritas a alguien que lo necesite.",
19: "Renuncia a algo de comer para regalarlo a un indigente.",
20: "Reza un Rosario por todas las mujeres embarazadas y por todos los concebidos no nacidos.",
21: "Es momento de desconectarte de la tecnología y utilizar ese tiempo para preparar tu corazón.",
22: "Lleva a un amigo a visitar al Santísimo, luego haz lo mismo con tu familia.",
23: "Invita a un necesitado de Dios a compartir una comida en tu hogar.",
24: "Ábrete a la gracia, ama, adora y contempla a Nuestro Salvador porque: ¡Jesús ha nacido!",
25: "Ábrete a la gracia, ama, adora y contempla a Nuestro Salvador porque: ¡Jesús ha nacido!"
};

const fechas = {
30: "30 de noviembre",
1: "1 de diciembre",
2: "2 de diciembre",
3: "3 de diciembre",
4: "4 de diciembre",
5: "5 de diciembre",
6: "6 de diciembre",
7: "7 de diciembre",
8: "8 de diciembre",
9: "9 de diciembre",
10: "10 de diciembre",
11: "11 de diciembre",
12: "12 de diciembre",
13: "13 de diciembre",
14: "14 de diciembre",
15: "15 de diciembre",
16: "16 de diciembre",
17: "17 de diciembre",
18: "18 de diciembre",
19: "19 de diciembre",
20: "20 de diciembre",
21: "21 de diciembre",
22: "22 de diciembre",
23: "23 de diciembre",
24: "24 de diciembre",
25: "25 de diciembre"
};

const imagenesDias = {
30: "images/30.jpg",
1: "images/1.jpg",
2: "images/2.jpg",
3: "images/3.jpg",
4: "images/4.jpg",
5: "images/5.jpg",
6: "images/6.jpg",
7: "images/7.jpg",
8: "images/8.jpg",
9: "images/9.jpg",
10: "images/10.jpg",
11: "images/11.jpg",
12: "images/12.jpg",
13: "images/13.jpg",
14: "images/14.jpg",
15: "images/15.jpg",
16: "images/16.jpg",
17: "images/17.jpg",
18: "images/18.jpg",
19: "images/19.jpg",
20: "images/20.jpg",
21: "images/21.jpg",
22: "images/22.jpg",
23: "images/23.jpg",
24: "images/24.jpg",
25: "images/25.jpg"
};

const modalImages = {
30: "images/modal30.jpg",
1: "images/modal1.jpg",
2: "images/modal2.jpg",
3: "images/modal3.jpg",
4: "images/modal4.jpg",
5: "images/modal5.jpg",
6: "images/modal6.jpg",
7: "images/modal7.jpg",
8: "images/modal8.jpg",
9: "images/modal9.jpg",
10: "images/modal10.jpg",
11: "images/modal11.jpg",
12: "images/modal12.jpg",
13: "images/modal13.jpg",
14: "images/modal14.jpg",
15: "images/modal15.jpg",
16: "images/modal16.jpg",
17: "images/modal17.jpg",
18: "images/modal18.jpg",
19: "images/modal19.jpg",
20: "images/modal20.jpg",
21: "images/modal21.jpg",
22: "images/modal22.jpg",
23: "images/modal23.jpg",
24: "images/modal24.jpg",
25: "images/modal24.jpg"
};

const grid = document.getElementById("grid");
const dias = [30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25];

dias.forEach(d => {
    const btn = document.createElement("button");
    btn.className = "day-btn";

    const img = document.createElement("img");
    img.className = "day-img";
    img.src = imagenesDias[d] || "images/default.jpg";
    btn.appendChild(img);

    const numberDiv = document.createElement("div");
    numberDiv.className = "day-number";
    numberDiv.innerText = d;
    btn.appendChild(numberDiv);

    btn.onclick = () => openModal(d);
    grid.appendChild(btn);
});

let currentDay = null;

function openModal(dia) {
    currentDay = dia;
    document.getElementById("modal-title").innerText = fechas[dia];
    document.getElementById("modal-image").src = modalImages[dia] || "images/default_modal.jpg";
    document.getElementById("modal").style.display = "flex";
}

function closeModal(e) {
    if (e.target.id === "modal") document.getElementById("modal").style.display = "none";
}

function closeModalBtn(e) {
    e.stopPropagation();
    document.getElementById("modal").style.display = "none";
}

function registerUser() {
    const name = document.getElementById("name-input").value.trim();
    if (!name) { alert("Escribe tu nombre"); return; }
    const user = { id: "user_" + Date.now(), name: name };
    localStorage.setItem("adv-user", JSON.stringify(user));
    fetch(DEPLOY_URL, {
        method: "POST",
        body: JSON.stringify({ action: "register", user })
    }).then(r => r.json()).then(res => alert("Registrado correctamente"));
}

function recoverUser() {
    const name = document.getElementById("name-input").value.trim();
    if (!name) { alert("Escribe tu nombre"); return; }

    fetch(DEPLOY_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getUserByName", name: name })
    })
    .then(r => r.json())
    .then(res => {
        if (!res.success) { alert(res.msg || "Usuario no encontrado"); return; }

        localStorage.setItem("adv-user", JSON.stringify(res.user));
        alert("Usuario recuperado correctamente");

        const completed = res.completedDays || [];
        completed.forEach(d => {
            const btn = [...document.getElementsByClassName("day-btn")].find(b => b.querySelector(".day-number").innerText == d);
            if (btn) btn.classList.add("day-completed");
        });

        updateProgressBar();
    })
    .catch(err => console.error(err));
}

function confirmActivity() {
    const user = JSON.parse(localStorage.getItem("adv-user") || "{}");
    if (!user.id) { alert("Regístrate primero."); return; }
    fetch(DEPLOY_URL, {
        method: "POST",
        body: JSON.stringify({
            action: "click",
            user,
            dia: currentDay,
            text: actividades[currentDay],
            timestamp: new Date().toISOString()
        })
    }).then(r => r.json()).then(res => {
        alert("Actividad registrada");
        document.getElementById("modal").style.display = "none";
        const btn = [...document.getElementsByClassName("day-btn")].find(b => b.querySelector(".day-number").innerText == currentDay);
        if (btn) btn.classList.add("day-completed");
        updateProgressBar();
    });
}

function updateProgressBar() {
    const completed = document.getElementsByClassName("day-completed").length;
    const total = dias.length;
    const percent = Math.round((completed / total) * 100);
    const bar = document.getElementById("progress-bar");
    bar.style.width = percent + "%";
    bar.innerText = percent + "%";
}
</script>

</body>
</html>

